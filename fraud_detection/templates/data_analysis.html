<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analysis Report</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
    <h1>Data Analysis Report</h1>

    <h2>Statistics</h2>
    <pre>{{ stats }}</pre>

    <h2>Fraud Count</h2>
    <ul>
        {% for key, value in fraud_count.items %}
            <li>{{ key }}: {{ value }}</li>
        {% endfor %}
    </ul>

    <h2>Model Results</h2>
    <pre>{{ model_results }}</pre>

    <h2>Training Results</h2>
    <pre>{{ training_results }}</pre>

    <h2>Model Optimization Results</h2>
    <ul>
        {% for model, accuracy in optimization_results.items %}
            <li>{{ model }}: {{ accuracy }}</li>
        {% endfor %}
    </ul>

    <h2>Best Hyperparameters</h2>
    <p>Best Hyperparameters: {{ optimization_results.Best_Hyperparameters }}</p>

    <h2>Real-Time Predictions</h2>
    <div id="real-time-results">
        {% if latest_predictions %}
            {% for prediction in latest_predictions %}
                <p>
                    Transaction ID: {{ prediction.id }},
                    Amount: {{ prediction.amount }},
                    Fraud: {{ prediction.isFraud }},
                    Timestamp: {{ prediction.timestamp }},
                    User ID: {{ prediction.nameOrig }}
                </p>
            {% endfor %}
        {% else %}
            <p>No predictions yet.</p>
        {% endif %}
    </div>

    <script>
        // Function to refresh the real-time predictions every 5 seconds
        setInterval(() => {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", window.location.href, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(xhr.responseText, "text/html");
                    const newResults = doc.querySelector("#real-time-results").innerHTML;
                    document.querySelector("#real-time-results").innerHTML = newResults;
                }
            };
            xhr.send();
        }, 5000);
    </script>
</body>
</html>
